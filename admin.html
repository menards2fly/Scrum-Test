<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Admin - Scrumptious Certs</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
<header>
  <img src="logo.png" class="logo-img" alt="Scrumptious Certs Logo"/>
  <nav id="main-nav" class="nav"></nav>
</header>
<div class="container main">
  <h2>Admin Panel</h2>
  <input type="password" id="adminKey" placeholder="Admin Key" />
  <button onclick="unlock()">Unlock</button>
  <div id="adminContent" style="display:none;margin-top:20px;">
    <input id="targetUser" placeholder="Username (or 'all')" /><br/>
    <label>Announcements:</label>
    <textarea id="annInput" rows="4"></textarea>
    <label>Certificate Status:</label>
    <input id="statusInput" />
    <label>Device Status:</label>
    <input id="deviceInput" />
    <label>Download Link:</label>
    <input id="linkInput" />
    <button onclick="saveData()">Save</button>
    <p id="statusMsg"></p>
  </div>
</div>
<script>
const ADMIN_KEY = "supersecretkey";
let db = {};

function unlock() {
  const key = document.getElementById("adminKey").value;
  if (key === ADMIN_KEY) {
    document.getElementById("adminContent").style.display = "block";
    document.getElementById("statusMsg").textContent = "";
    loadData();
  } else {
    document.getElementById("statusMsg").textContent = "Invalid key.";
  }
}

function loadData() {
  fetch("data.json")
    .then(r => r.json())
    .then(d => {
      db = d;
      const user = document.getElementById("targetUser").value || "all";
      document.getElementById("annInput").value = (d.announcements[user] || []).join("\n");
      document.getElementById("statusInput").value = d.certStatus[user] || "";
      document.getElementById("deviceInput").value = d.deviceStatus[user] || "";
      document.getElementById("linkInput").value = d.certDownloadLink[user] || "";
    });
}

function saveData() {
  const user = document.getElementById("targetUser").value || "all";
  db.announcements[user] = document.getElementById("annInput").value.split("\n");
  db.certStatus[user] = document.getElementById("statusInput").value;
  db.deviceStatus[user] = document.getElementById("deviceInput").value;
  db.certDownloadLink[user] = document.getElementById("linkInput").value;
  const blob = new Blob([JSON.stringify(db, null, 2)], {type: "application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "data.json";
  a.click();
  URL.revokeObjectURL(url);
  document.getElementById("statusMsg").textContent = "Download ready. Replace the data.json file on your site.";
}
</script>
<script src="script.js"></script>
</body>
</html>
